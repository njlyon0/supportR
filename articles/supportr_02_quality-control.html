<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Quality Control • supportR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Quality Control">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">supportR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.5.0.900</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/supportr_01_wrangle.html">Data Wrangling</a></li>
    <li><a class="dropdown-item" href="../articles/supportr_02_quality-control.html">Quality Control</a></li>
    <li><a class="dropdown-item" href="../articles/supportr_03_visualizations.html">Data Visualization</a></li>
    <li><a class="dropdown-item" href="../articles/supportr_04_outside-of-r.html">Operating Outside of R</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/njlyon0/supportR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Quality Control</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/njlyon0/supportR/blob/main/vignettes/supportr_02_quality-control.Rmd" class="external-link"><code>vignettes/supportr_02_quality-control.Rmd</code></a></small>
      <div class="d-none name"><code>supportr_02_quality-control.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>The <code>supportR</code> package is an amalgam of distinct functions
I’ve written to accomplish small data wrangling, quality control, or
visualization tasks. These functions tend to be short and
narrowly-defined. An additional consequence of the motivation for
creating them is that they tend to not be inter-related or united by a
common theme. If this vignette feels somewhat scattered because of that,
I hope it doesn’t negatively affect how informative it is or your
willingness to adopt <code>supportR</code> into your scripts!</p>
<p>This vignette describes the main functions of <code>supportR</code>
using the examples included in each function.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#install.packages("supportR")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/njlyon0/supportR" class="external-link">supportR</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="identify-differences-between-two-vectors">Identify Differences Between Two Vectors<a class="anchor" aria-label="anchor" href="#identify-differences-between-two-vectors"></a>
</h3>
<p>In terms of quality control functions, <code>diff_check</code>
compares two vectors and reports back what is in the first but not the
second (i.e., what is “lost”) and what is in the second but not the
first (i.e., what is “gained”). I find this most useful (A) when
comparing the index columns of two data objects I intend to join
together and (B) to ensure no columns are unintentionally removed during
lengthy <code>tidyverse</code>-style pipes (<code>%&gt;%</code>).</p>
<p><code>diff_check</code> also includes optional logical arguments
<code>sort</code> and <code>return</code> that will respectively either
sort the difference in both vectors and return a two-element if set to
<code>TRUE</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Make two vectors</span></span>
<span><span class="va">vec1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"a"</span>, <span class="st">"b"</span><span class="op">)</span></span>
<span><span class="va">vec2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"y"</span>, <span class="st">"z"</span>, <span class="st">"a"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compare them!</span></span>
<span><span class="fu">supportR</span><span class="fu">::</span><span class="fu"><a href="../reference/diff_check.html">diff_check</a></span><span class="op">(</span>old <span class="op">=</span> <span class="va">vec1</span>, new <span class="op">=</span> <span class="va">vec2</span>, sort <span class="op">=</span> <span class="cn">TRUE</span>, return <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Following element(s) found in old object but not new:</span></span>
<span><span class="co">#&gt; [1] "b" "x"</span></span>
<span><span class="co">#&gt; Following element(s) found in new object but not old:</span></span>
<span><span class="co">#&gt; [1] "y" "z"</span></span>
<span><span class="co">#&gt; $lost</span></span>
<span><span class="co">#&gt; [1] "b" "x"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $gained</span></span>
<span><span class="co">#&gt; [1] "y" "z"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="identify-non-numbers">Identify Non-Numbers<a class="anchor" aria-label="anchor" href="#identify-non-numbers"></a>
</h3>
<p>This package also includes the function <code>num_check</code> that
identifies all values of a column that would be coerced to
<code>NA</code> if <code>as.numeric</code> was run on the column. Once
these non-numbers are identified you can handle that in whatever way you
feel is most appropriate. <code>num_check</code> is intended only to
flag these for your attention, <em>not</em> to attempt a fix using a
method you may or may not support.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Make a dataframe with non-numbers in a number column</span></span>
<span><span class="va">fish</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">"species"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"salmon"</span>, <span class="st">"bass"</span>, <span class="st">"halibut"</span>, <span class="st">"eel"</span><span class="op">)</span>,</span>
<span>                   <span class="st">"count"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="st">"14x"</span>, <span class="st">"_23"</span>, <span class="fl">12</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use `num_check` to identify non-numbers</span></span>
<span><span class="fu">supportR</span><span class="fu">::</span><span class="fu"><a href="../reference/num_check.html">num_check</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">fish</span>, col <span class="op">=</span> <span class="st">"count"</span><span class="op">)</span></span>
<span><span class="co">#&gt; For 'count', 2 non-numbers identified: '14x' | '_23'</span></span>
<span><span class="co">#&gt; $count</span></span>
<span><span class="co">#&gt; [1] "14x" "_23"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="identify-malformed-dates">Identify Malformed Dates<a class="anchor" aria-label="anchor" href="#identify-malformed-dates"></a>
</h3>
<p><code>date_check</code> does a similar operation but is checking a
column for entries that would be coerced to <code>NA</code> by
<code>as.Date</code> instead. Note that if a date is sufficiently badly
formatted <code>as.Date</code> will throw an error instead of coercing
to <code>NA</code> so <code>date_check</code> will do the same
thing.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Make a dataframe including malformed dates</span></span>
<span><span class="va">sites</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">"site"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"LTR"</span>, <span class="st">"GIL"</span>, <span class="st">"PYN"</span>, <span class="st">"RIN"</span><span class="op">)</span>,</span>
<span>                    <span class="st">"visit"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2021-01-01"</span>, <span class="st">"2021-01-0w"</span>, <span class="st">"1990"</span>, <span class="st">"2020-10-xx"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Now we can use our function to identify bad dates</span></span>
<span><span class="fu">supportR</span><span class="fu">::</span><span class="fu"><a href="../reference/date_check.html">date_check</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">sites</span>, col <span class="op">=</span> <span class="st">"visit"</span><span class="op">)</span></span>
<span><span class="co">#&gt; For 'visit', 3 non-dates identified: '2021-01-0w' | '1990' | '2020-10-xx'</span></span>
<span><span class="co">#&gt; $visit</span></span>
<span><span class="co">#&gt; [1] "2021-01-0w" "1990"       "2020-10-xx"</span></span></code></pre></div>
<p>Both <code>num_check</code> and <code>date_check</code> can accept
multiple column names to the <code>col</code> argument (as of version
1.1.1) and all columns are checked separately.</p>
</div>
<div class="section level3">
<h3 id="deduce-date-formats-from-ambiguous-dates">Deduce Date Formats from Ambiguous Dates<a class="anchor" aria-label="anchor" href="#deduce-date-formats-from-ambiguous-dates"></a>
</h3>
<p>Another date column quality control function is
<code>date_format_guess</code>. This This function checks a column of
dates (stored as characters!) and tries to guess the format of the date
(i.e., month/day/year, day/month/year, etc.).</p>
<p>It can make a more informed guess if there is a grouping column
because it can use the frequency of the “date” entries within those
groups to guess whether a given number is the day or the month. This is
based on the assumption that sampling occurs more often within months
than across them so the number that occurs in more rows within the
grouping values is most likely month.</p>
<p>Recognizing that assumption may be uncomfortable for some users, the
<code>groups</code> argument can be set to <code>FALSE</code> and it
will do the clearer judgment calls (i.e., if a number is &gt;12 it is
day, etc.). Note that dates that cannot be guessed by my function will
return “FORMAT UNCERTAIN” so that you can handle them using your
knowledge of the system (or by returning to your raw data if need
be).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Make a dataframe with dates in various formats and a grouping column</span></span>
<span><span class="va">my_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">"data_enterer"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"person A"</span>, <span class="st">"person B"</span>,</span>
<span>                                       <span class="st">"person B"</span>, <span class="st">"person B"</span>,</span>
<span>                                       <span class="st">"person C"</span>, <span class="st">"person D"</span>,</span>
<span>                                       <span class="st">"person E"</span>, <span class="st">"person F"</span>,</span>
<span>                                       <span class="st">"person G"</span><span class="op">)</span>,</span>
<span>                    <span class="st">"bad_dates"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2022.13.08"</span>, <span class="st">"2021/2/02"</span>,</span>
<span>                                    <span class="st">"2021/2/03"</span>, <span class="st">"2021/2/04"</span>,</span>
<span>                                    <span class="st">"1899/1/15"</span>, <span class="st">"10-31-1901"</span>,</span>
<span>                                    <span class="st">"26/11/1901"</span>, <span class="st">"08.11.2004"</span>,</span>
<span>                                    <span class="st">"6/10/02"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Now we can invoke the function!</span></span>
<span><span class="fu">supportR</span><span class="fu">::</span><span class="fu"><a href="../reference/date_format_guess.html">date_format_guess</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">my_df</span>, date_col <span class="op">=</span> <span class="st">"bad_dates"</span>,</span>
<span>                            group_col <span class="op">=</span> <span class="st">"data_enterer"</span>, return <span class="op">=</span> <span class="st">"dataframe"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Returning dataframe of data format guesses</span></span>
<span><span class="co">#&gt;   data_enterer  bad_dates     format_guess</span></span>
<span><span class="co">#&gt; 1     person A 2022.13.08   year/day/month</span></span>
<span><span class="co">#&gt; 2     person B  2021/2/02   year/month/day</span></span>
<span><span class="co">#&gt; 3     person B  2021/2/03   year/month/day</span></span>
<span><span class="co">#&gt; 4     person B  2021/2/04   year/month/day</span></span>
<span><span class="co">#&gt; 5     person C  1899/1/15   year/month/day</span></span>
<span><span class="co">#&gt; 6     person D 10-31-1901   month/day/year</span></span>
<span><span class="co">#&gt; 7     person E 26/11/1901   day/month/year</span></span>
<span><span class="co">#&gt; 8     person F 08.11.2004 FORMAT UNCERTAIN</span></span>
<span><span class="co">#&gt; 9     person G    6/10/02 FORMAT UNCERTAIN</span></span>
<span></span>
<span><span class="co"># If preferred, do it without groups and return a vector</span></span>
<span><span class="fu">supportR</span><span class="fu">::</span><span class="fu"><a href="../reference/date_format_guess.html">date_format_guess</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">my_df</span>, date_col <span class="op">=</span> <span class="st">"bad_dates"</span>,</span>
<span>                            groups <span class="op">=</span> <span class="cn">FALSE</span>, return <span class="op">=</span> <span class="st">"vector"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Defining 'groups' is strongly recommended! If none exist, consider adding a single artificial group shared by all rows then re-run this function</span></span>
<span><span class="co">#&gt; Returning vector of data format guesses</span></span>
<span><span class="co">#&gt; [1] "year/day/month"   "FORMAT UNCERTAIN" "FORMAT UNCERTAIN" "FORMAT UNCERTAIN"</span></span>
<span><span class="co">#&gt; [5] "year/month/day"   "month/day/year"   "day/month/year"   "FORMAT UNCERTAIN"</span></span>
<span><span class="co">#&gt; [9] "FORMAT UNCERTAIN"</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Nicholas J Lyon.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
